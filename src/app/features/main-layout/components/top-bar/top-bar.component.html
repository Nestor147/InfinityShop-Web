<header
  class="sticky top-0 z-40 border-b
         bg-gradient-to-r from-sa-topbar-light-from via-sa-topbar-light-via to-sa-topbar-light-to
         text-slate-50 border-sa-topbar-light-border
         backdrop-blur supports-[backdrop-filter]:bg-transparent

         dark:text-sa-text
         dark:border-sa-border/80
         dark:bg-[radial-gradient(circle_at_top,_rgba(129,140,248,0.22),transparent_55%),radial-gradient(circle_at_bottom,_rgba(34,197,94,0.16),transparent_60%),linear-gradient(to_right,#020617,#02081b,#020617))]
         dark:supports-[backdrop-filter]:bg-transparent"
>
  <div class="mx-auto max-w-7xl px-3 sm:px-4 lg:px-6">
    <div class="h-14 sm:h-16 flex items-center gap-3">

      <!-- Botón menú lateral -->
      <button
        type="button"
        (click)="menuToggle.emit()"
        class="cursor-pointer p-2 rounded-xl border border-sky-900/70 bg-sky-900/60 hover:bg-sky-900/80 hover:border-sky-800
               text-slate-50
               dark:bg-sa-surface-alt/80 dark:border-sa-border dark:hover:border-sa-cta-from dark:hover:bg-sa-surface/90
               transition focus:outline-none focus-visible:ring-2 focus-visible:ring-sa-cta-from"
        [attr.aria-label]="t().sideMenuAria"
      >
        <svg-icon
          src="assets/icons/icon-menu-sidebar.svg"
          [svgClass]="'w-5 h-5 text-slate-50 dark:text-sa-text'"
        ></svg-icon>
      </button>

      <!-- Marca + subtítulo -->
      <div class="hidden sm:flex items-center gap-3 select-none">
        <div class="flex flex-col">
          <div class="flex items-center gap-2">
            <span class="text-sm font-semibold tracking-wide text-slate-50 dark:text-sa-text">
              {{ brand }}
            </span>
            <span
              *ngIf="envLabel"
              class="text-[10px] px-2 py-0.5 rounded-full border
                     border-sky-200/40 bg-sky-100/20 text-sky-50
                     dark:border-sa-border/80 dark:bg-sa-surface-alt/70 dark:text-sa-text-soft"
            >
              {{ envLabel }}
            </span>
          </div>
          <span class="text-[11px] text-slate-200/90 dark:text-sa-muted">
            {{ t().subtitle }}
          </span>
        </div>
      </div>

      <div class="ml-auto flex items-center gap-1 sm:gap-2">

        <!-- Chip estado -->
        <div class="hidden md:flex items-center gap-2 rounded-xl px-3 py-1.5
                    bg-sky-900/40 border border-sky-900/70 text-[11px] text-sky-50
                    dark:bg-sa-surface-alt/80 dark:border-sa-border/80 dark:text-sa-text-soft">
          <span class="inline-flex items-center gap-1">
            <span class="h-1.5 w-1.5 rounded-full bg-emerald-400 animate-pulse"></span>
            <span>{{ t().statusChipLabel }}</span>
          </span>
          <span class="w-px h-3 bg-sky-200/40 dark:bg-sa-border/70"></span>
          <span class="hidden lg:inline-flex items-center gap-1">
            <i class="ri-time-line text-[12px]"></i>
            <span>{{ t().statusRealtime }}</span>
          </span>
        </div>

        <!-- Botón tema -->
        <button
          type="button"
          (click)="toggleDarkMode()"
          class="cursor-pointer relative flex items-center gap-1.5 px-2.5 py-1.5 rounded-xl
                 border border-sky-900/70 bg-sky-900/60 hover:bg-sky-900/80 hover:border-sky-800
                 text-slate-50
                 dark:bg-sa-surface-alt/80 dark:border-sa-border dark:hover:border-sa-cta-from dark:hover:bg-sa-surface/90
                 transition text-[11px] font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-sa-cta-from"
          [attr.aria-label]="t().themeAria"
        >
          <span
            class="inline-flex items-center justify-center h-5 w-5 rounded-lg
                   bg-slate-950/80 text-amber-300
                   dark:bg-sa-surface/90 dark:text-amber-200"
          >
            <svg-icon
              *ngIf="!isDarkMode()"
              src="assets/icons/icon-moon.svg"
              class="w-3.5 h-3.5"
            ></svg-icon>
            <svg-icon
              *ngIf="isDarkMode()"
              src="assets/icons/icon-sun.svg"
              class="w-3.5 h-3.5"
            ></svg-icon>
          </span>
          <span class="hidden sm:inline">
            {{ isDarkMode() ? t().themeLabelDark : t().themeLabelLight }}
          </span>
        </button>

        <!-- Selector de idioma (ahora también en móvil) -->
        <div class="relative" data-menu-root>
          <button
            type="button"
            (click)="onToggleLang($event)"
            class="inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-xl
                   text-[10px] sm:text-[11px] font-medium
                   cursor-pointer select-none
                   bg-sky-900/35 border border-sky-900/70 text-sky-50
                   hover:bg-sky-900/60 hover:border-sky-800
                   dark:bg-sa-surface-alt/80 dark:border-sa-border/80 dark:text-sa-text-soft
                   dark:hover:bg-sa-surface/90 dark:hover:border-sa-cta-from
                   transition"
            [attr.aria-label]="t().langMenuAria"
            aria-haspopup="menu"
            [attr.aria-expanded]="langMenuOpen()"
          >
            <i class="ri-translate-2 text-[13px] text-sky-100 dark:text-sa-text-soft"></i>
            <!-- código corto siempre visible -->
            <span class="uppercase tracking-wide ">
              {{ t().langShort }}
            </span>
            <!-- nombre largo solo en pantallas grandes -->
            <span class="hidden lg:inline text-xs text-sky-100/80 dark:text-sa-muted">
              {{ t().langLong }}
            </span>
          </button>

          <div
            *ngIf="langMenuOpen()"
            class="absolute right-0 mt-2 w-40 rounded-2xl border
                   border-sky-200/80 bg-sky-50/95 text-sky-900
                   backdrop-blur-sm p-2
                   dark:border-sa-border/80 dark:bg-sa-surface/95 dark:text-sa-text"
            role="menu"
          >
            <button
              *ngFor="let option of languages"
              type="button"
              (click)="changeLang(option.code); langMenuOpen.set(false)"
              class="w-full text-left px-2 py-1.5 rounded-xl text-[11px]
                     hover:bg-sky-100 hover:text-sky-900
                     dark:hover:bg-sa-surface-alt dark:hover:text-sa-cta-from cursor-pointer"
              [hidden]="option.code === lang()"
            >
              {{ option.label }}
            </button>
          </div>
        </div>

        <!-- Sesiones / alertas -->
        <div class="hidden lg:flex items-center gap-2 rounded-xl px-3 py-1.5
                    bg-sky-900/35 border border-sky-900/70 text-[11px] text-sky-50
                    dark:bg-sa-surface-alt/80 dark:border-sa-border/80 dark:text-sa-text-soft">
          <div class="flex items-center gap-1">
            <i class="ri-user-search-line text-[13px]"></i>
            <span>{{ t().sessionsLabel }}: 12</span>
          </div>
          <span class="w-px h-3 bg-sky-200/40 dark:bg-sa-border/70"></span>
          <div class="flex items-center gap-1">
            <i class="ri-error-warning-line text-[13px] text-amber-300"></i>
            <span>{{ t().alertsLabel }}: 3</span>
          </div>
        </div>

        <!-- Lanzador rápido -->
        <div class="relative" data-menu-root>
          <button
            type="button"
            (click)="onToggleLauncher($event)"
            class="cursor-pointer p-2 rounded-xl border border-sky-900/70 bg-sky-900/60 hover:bg-sky-900/80 hover:border-sky-800
                   text-slate-50
                   dark:bg-sa-surface-alt/80 dark:border-sa-border dark:hover:border-sa-cta-from dark:hover:bg-sa-surface/90
                   transition focus:outline-none focus-visible:ring-2 focus-visible:ring-sa-cta-from"
            aria-haspopup="menu"
            [attr.aria-expanded]="launcherOpen()"
          >
            <svg-icon
              src="assets/icons/icon-menu-access.svg"
              [svgClass]="'w-5 h-5 text-slate-50 dark:text-sa-text/90'"
            ></svg-icon>
          </button>

          <div
            *ngIf="launcherOpen()"
            class="absolute right-0 mt-2 w-72 rounded-2xl border
                   border-sky-200/80 bg-sky-50/95 text-sky-900
                   backdrop-blur-sm p-3
                   dark:border-sa-border/80 dark:bg-sa-surface/95 dark:text-sa-text dark:backdrop-blur"
            role="menu"
          >
            <div class="mb-2 flex items-center justify-between text-[11px]">
              <span class="font-medium text-sky-950 dark:text-sa-text-soft">{{ t().quickAccessTitle }}</span>
              <span class="inline-flex items-center gap-1 text-sky-600 dark:text-sa-muted">
                <i class="ri-flashlight-line text-[12px] text-sa-cta-from"></i>
                <span>{{ t().quickAccessProductivity }}</span>
              </span>
            </div>

            <div class="grid grid-cols-3 gap-2">
              <button
                (click)="action.emit('users'); launcherOpen.set(false)"
                class="cursor-pointer group flex flex-col items-center gap-1 rounded-xl p-3
                       bg-sky-50 hover:bg-sky-100 text-center text-[11px] text-sky-900
                       border border-sky-200 hover:border-sky-400
                       dark:bg-sa-surface-alt/80 dark:text-sa-text dark:border-sa-border/80
                       dark:hover:bg-sa-surface/90 dark:hover:border-sa-cta-from
                       transition"
              >
                <svg
                  class="size-6 text-sky-600 group-hover:text-sky-800
                         dark:text-sa-text/90 dark:group-hover:text-sa-cta-from transition"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M17 21v-2a4 4 0 0 0-4-4H7a4 4 0 0 0-4 4v2" />
                  <circle cx="9" cy="7" r="4" />
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                  <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                </svg>
                <span>{{ t().quickAccessUsers }}</span>
              </button>

              <button
                (click)="action.emit('roles'); launcherOpen.set(false)"
                class="cursor-pointer group flex flex-col items-center gap-1 rounded-xl p-3
                       bg-sky-50 hover:bg-sky-100 text-center text-[11px] text-sky-900
                       border border-sky-200 hover:border-sky-400
                       dark:bg-sa-surface-alt/80 dark:text-sa-text dark:border-sa-border/80
                       dark:hover:bg-sa-surface/90 dark:hover:border-sa-cta-from
                       transition"
              >
                <svg
                  class="size-6 text-sky-600 group-hover:text-sky-800
                         dark:text-sa-text/90 dark:group-hover:text-sa-cta-from transition"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M12 2l7 4v6c0 5-3.5 9-7 10-3.5-1-7-5-7-10V6l7-4z" />
                  <path d="M9 12l2 2 4-4" />
                </svg>
                <span>{{ t().quickAccessRoles }}</span>
              </button>

              <button
                (click)="action.emit('permissions'); launcherOpen.set(false)"
                class="cursor-pointer group flex flex-col items-center gap-1 rounded-xl p-3
                       bg-sky-50 hover:bg-sky-100 text-center text-[11px] text-sky-900
                       border border-sky-200 hover:border-sky-400
                       dark:bg-sa-surface-alt/80 dark:text-sa-text dark:border-sa-border/80
                       dark:hover:bg-sa-surface/90 dark:hover:border-sa-cta-from
                       transition"
              >
                <svg
                  class="size-6 text-sky-600 group-hover:text-sky-800
                         dark:text-sa-text/90 dark:group-hover:text-sa-cta-from transition"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <rect x="3" y="4" width="18" height="14" rx="2" />
                  <path d="M7 8h10M7 12h6" />
                </svg>
                <span>{{ t().quickAccessPermissions }}</span>
              </button>

              <button
                (click)="action.emit('audit'); launcherOpen.set(false)"
                class="cursor-pointer group flex flex-col items-center gap-1 rounded-xl p-3
                       bg-sky-50 hover:bg-sky-100 text-center text-[11px] text-sky-900
                       border border-sky-200 hover:border-sky-400
                       dark:bg-sa-surface-alt/80 dark:text-sa-text dark:border-sa-border/80
                       dark:hover:bg-sa-surface/90 dark:hover:border-sa-cta-from
                       transition"
              >
                <svg
                  class="size-6 text-sky-600 group-hover:text-sky-800
                         dark:text-sa-text/90 dark:group-hover:text-sa-cta-from transition"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M3 4h18v4H3z" />
                  <path d="M7 12h10M7 16h10" />
                </svg>
                <span>{{ t().quickAccessAudit }}</span>
              </button>

              <button
                (click)="action.emit('monitor'); launcherOpen.set(false)"
                class="cursor-pointer group flex flex-col items-center gap-1 rounded-xl p-3
                       bg-sky-50 hover:bg-sky-100 text-center text-[11px] text-sky-900
                       border border-sky-200 hover:border-sky-400
                       dark:bg-sa-surface-alt/80 dark:text-sa-text dark:border-sa-border/80
                       dark:hover:bg-sa-surface/90 dark:hover:border-sa-cta-from
                       transition"
              >
                <svg
                  class="size-6 text-sky-600 group-hover:text-sky-800
                         dark:text-sa-text/90 dark:group-hover:text-sa-cta-from transition"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <rect x="2" y="3" width="20" height="14" rx="2" />
                  <path d="M8 21h8M12 17v4" />
                  <path d="M4 10l3 3 4-6 3 4 3-2" />
                </svg>
                <span>{{ t().quickAccessMonitor }}</span>
              </button>

              <button
                (click)="action.emit('settings'); launcherOpen.set(false)"
                class="cursor-pointer group flex flex-col items-center gap-1 rounded-xl p-3
                       bg-sky-50 hover:bg-sky-100 text-center text-[11px] text-sky-900
                       border border-sky-200 hover:border-sky-400
                       dark:bg-sa-surface-alt/80 dark:text-sa-text dark:border-sa-border/80
                       dark:hover:bg-sa-surface/90 dark:hover:border-sa-cta-from
                       transition"
              >
                <svg
                  class="size-6 text-sky-600 group-hover:text-sky-800
                         dark:text-sa-text/90 dark:group-hover:text-sa-cta-from transition"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="12" cy="12" r="3" />
                  <path
                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06A1.65 1.65 0 0 0 15 19.4"
                  />
                </svg>
                <span>{{ t().quickAccessSettings }}</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Menú usuario -->
        <div class="relative" data-menu-root>
          <button
            type="button"
            (click)="onToggleUser($event)"
            class="cursor-pointer flex items-center gap-2 pl-2 pr-2.5 h-10 rounded-xl
                   border border-sky-900/70 bg-sky-900/60 hover:bg-sky-900/80 hover:border-sky-800
                   text-slate-50
                   dark:bg-sa-surface-alt/80 dark:border-sa-border dark:hover:bg-sa-surface/90 dark:hover:border-sa-cta-from
                   transition focus:outline-none focus-visible:ring-2 focus-visible:ring-sa-cta-from"
            aria-haspopup="menu"
            [attr.aria-expanded]="userOpen()"
          >
            <div class="hidden sm:flex flex-col items-end leading-none">
              <span class="text-xs font-medium text-slate-50 dark:text-sa-text-soft">
                {{ userName }}
              </span>
              <span class="text-[10px] text-slate-200/90 dark:text-sa-muted">
                {{ t().userRoleLabel }}
              </span>
            </div>
            <span
              class="inline-grid place-items-center size-8 rounded-lg
                     bg-slate-950/80 text-slate-50 text-sm font-semibold
                     dark:bg-sa-surface/90 dark:text-sa-text-soft"
            >
              {{ avatarText }}
            </span>
          </button>

          <div
            *ngIf="userOpen()"
            class="absolute right-0 mt-2 w-56 rounded-2xl border
                   border-sky-200/80 bg-sky-50/95 text-sky-900 p-2
                   backdrop-blur-sm
                   dark:border-sa-border/80 dark:bg-sa-surface/95 dark:text-sa-text dark:backdrop-blur"
          >
            <div class="px-3 py-2 text-[11px] text-sky-700/90 dark:text-sa-muted">
              {{ t().userSessionHint }}
            </div>

            <button
              (click)="userAction.emit('profile'); userOpen.set(false)"
              class="group cursor-pointer w-full flex items-center gap-2 text-left px-3 py-2 rounded-xl
                     text-sm text-sky-900
                     hover:bg-sky-100 hover:text-sky-950 hover:ring-1 hover:ring-sky-200
                     focus-visible:ring-2 focus-visible:ring-sky-300
                     transition-colors transition-transform duration-150 ease-out hover:translate-x-[1px]
                     dark:text-sa-text/90 dark:hover:bg-sa-surface-alt/90 dark:hover:text-sa-text"
            >
              <svg
                class="w-4 h-4 text-sky-600 transition-colors group-hover:text-sky-800
                       dark:text-sa-text/70 dark:group-hover:text-sa-cta-from"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4z" />
                <path d="M4 20a8 8 0 0 1 16 0" />
              </svg>
              <span class="dark:group-hover:text-sa-cta-from">{{ t().userMenuProfile }}</span>
            </button>

            <button
              (click)="userAction.emit('logout'); userOpen.set(false)"
              class="group cursor-pointer mt-1 w-full flex items-center gap-2 text-left px-3 py-2 rounded-xl
                     text-sm text-red-500
                     hover:bg-red-50 hover:text-red-600 hover:ring-1 hover:ring-red-200
                     focus-visible:ring-2 focus-visible:ring-red-300
                     transition-colors transition-transform duration-150 ease-out hover:translate-x-[1px]
                     dark:text-red-300 dark:hover:bg-sa-surface-alt/90"
            >
              <svg
                class="w-4 h-4 text-red-500 transition-colors group-hover:text-red-600
                       dark:text-red-300 dark:group-hover:text-red-200"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                <path d="M16 17l5-5-5-5" />
                <path d="M21 12H9" />
              </svg>
              <span>{{ t().userMenuLogout }}</span>
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div class="h-[2px] w-full bg-gradient-to-r from-sa-cta-from via-sa-cta-via to-sa-cta-to"></div>
</header>
